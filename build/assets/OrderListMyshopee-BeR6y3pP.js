import{V as Z,P as $,r as o,u as ee,j as e,X as se,c as ae,T as z}from"./index-CZtjPvJ4.js";import{T}from"./index-ClRc5ACL.js";import{u as te,g as ne,a as ie,b as re,c as le,T as oe,P as ce}from"./index-64zU6N20.js";import{S as de}from"./Select-C_onTc2Z.js";import{l as me,g as he}from"./index-TtNNhmIr.js";import{C as ue}from"./Card-DhOi8sr1.js";import{B as f}from"./Button-B1TureNB.js";import{B as p,D as xe}from"./Dialog-DM1qDp_-.js";import{T as ge,A as je}from"./index-UPzM3flb.js";import{S as fe}from"./ScrollBar-D3ZUvQY3.js";import{C as pe}from"./ConfirmDialog-CiRNUH8E.js";import{u as Se,f as be,g as Ce}from"./useResponsive-BlsyXzmI.js";import{t as w,N as P}from"./toast-D4hPnb2a.js";import"./classNames-YaQo_XSq.js";import"./useControllableState-BROaXCl2.js";import"./floating-ui.dom-CrYtpZAi.js";import"./CloseButton-C21If-Yh.js";import"./index-Dskg1t9S.js";import"./useMergeRef-DSPgMaPZ.js";import"./StatusIcon-uGY0kSTj.js";const{Tr:b,Th:n,Td:i,THead:O,TBody:R}=T;async function ve(d,m){const u=d?"/get-order-history/":"/franchisee-myshopee-order-list/"+m;return z.fetchDataWithAxios({url:u,method:"get"})}async function ye(d){return z.fetchDataWithAxios({url:"/franchisee-myshopee-order-confirm",method:"post",data:d})}const M=[{value:10,label:"10 / page"},{value:20,label:"20 / page"},{value:30,label:"30 / page"},{value:40,label:"40 / page"},{value:50,label:"50 / page"}],Ne=[e.jsx(p,{className:"mr-4",content:"Pending",innerClass:"bg-white text-gray-500"}),"Deleted",e.jsx(p,{className:"mr-4",content:"Complete",innerClass:"bg-emerald-500"})],Le=()=>{const{history:d}=Z();$();const[m,u]=o.useState([]),[A,k]=o.useState(!0),[x,_]=o.useState(null),[S,q]=o.useState([]),[B,g]=o.useState(!1),[E,C]=o.useState(!1),[v,y]=o.useState(null),[W,N]=o.useState(!1),[De,we]=o.useState(!1),{user:Y}=ee(),{smaller:H}=Se();o.useEffect(()=>{I()},[]);const I=()=>{ve(d,Y.id).then(s=>{u(s)}).catch(s=>{var r,t;_(((t=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:t.message)||s.toString())}).finally(()=>{k(!1)})},F=s=>{const r=m.map(t=>(t.id===s.order_id&&t.items.map(a=>{if(a.id===s.id){const c=a.issue?a.issue+1:1;c<=a.quantity-a.issued&&c<=a.balance&&(a.issue=c)}return a}),t));u(r)},Q=s=>{const r=m.map(t=>(t.id===s.order_id&&t.items.map(a=>{if(a.id===s.id){const c=a.issue?a.issue-1:0;c>=0&&(a.issue=c)}return a}),t));u(r)},U=m.length,h=te({data:m,getCoreRowModel:le(),getFilteredRowModel:re(),getPaginationRowModel:ie(),getSortedRowModel:ne()}),V=s=>{h.setPageIndex(s-1)},G=(s=0)=>{h.setPageSize(Number(s))},L=s=>{q(s),g(!0)},X=async()=>{var a,c;if(!v)return;N(!0),j();var s=[],r=!0;if(m.map(l=>{l.id===v&&(s=l.items.map(({id:D,issue:K})=>({id:D,issue:K})),l.items.some(({issue:D})=>D>0)&&(r=!1))}),r){w.push(e.jsx(P,{type:"danger",children:"Please issue atleast one item!"}),{placement:"top-center"}),N(!1),g(!1);return}const t={order_id:v,order_items:s};try{await ye(t)&&(C(!1),g(!1),y(null),w.push(e.jsx(P,{type:"success",children:"Order fullfilled!"}),{placement:"top-center"}),I())}catch(l){console.error("Error confirming order:",l),w.push(e.jsx(P,{type:"danger",children:((c=(a=l==null?void 0:l.response)==null?void 0:a.data)==null?void 0:c.message)||l.message.toString()||l.toString()}),{placement:"top-center"})}N(!1),j()},J=s=>{C(!0),y(s)},j=()=>{C(!1),y(null)};return x?e.jsx("div",{children:x||(x==null?void 0:x.message)}):e.jsxs("div",{children:[e.jsxs(ue,{children:[e.jsxs(T,{children:[e.jsx(O,{children:e.jsxs(b,{children:[e.jsx(n,{children:"Sl No"}),e.jsx(n,{children:"User ID"}),e.jsx(n,{children:"Name"}),e.jsx(n,{children:"Amount"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Date"}),d?null:e.jsx(n,{children:"Action"})]})}),A?e.jsx(oe,{columns:9,rows:10,avatarInColumns:[5,6,8],avatarProps:{width:28,height:28}}):e.jsx(R,{children:h.getRowModel().rows.map(s=>{var r,t;return e.jsxs(b,{children:[e.jsx(i,{children:s.index+1}),e.jsx(i,{children:(r=s.original.user)==null?void 0:r.user_id}),e.jsx(i,{children:(t=s.original.user)==null?void 0:t.name}),e.jsx(i,{children:s.original.amount}),e.jsx(i,{children:Ne[s.original.status]}),e.jsx(i,{children:se.unix(s.original.created_at).format("D MMM, YYYY h:mm a")}),d?null:e.jsx(i,{children:e.jsxs("div",{className:"flex justify-end text-lg gap-1",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(p,{className:"mr-2",innerClass:"bg-blue-500",content:s.original.items.length,children:e.jsx(ge,{title:"View items",children:e.jsx(f,{onClick:()=>L(s.original.items),shape:"circle",size:"sm",icon:e.jsx(me,{})})})})}),e.jsx(f,{icon:e.jsx(he,{}),variant:"plain",size:"xs",className:"bg-error text-white"})]})})]},s.original.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(ce,{pageSize:h.getState().pagination.pageSize,currentPage:h.getState().pagination.pageIndex+1,total:U,onChange:V}),e.jsx("div",{style:{minWidth:130},children:e.jsx(de,{size:"sm",isSearchable:!1,value:M.filter(s=>s.value===h.getState().pagination.pageSize),options:M,onChange:s=>G(s==null?void 0:s.value)})})]})]}),e.jsxs(xe,{isOpen:B,onClose:()=>g(!1),onRequestClose:()=>g(!1),width:850,children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h4",{className:"mb-1",children:"Ordered items"})}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(fe,{className:ae("overflow-y-auto h-120"),children:e.jsxs(T,{compact:H.sm,className:"mt-6",children:[e.jsx(O,{children:e.jsxs(b,{children:[e.jsx(n,{className:"w-[40%]",children:"Product"}),e.jsx(n,{className:"w-[20%]",children:"Price"}),e.jsx(n,{className:"w-[10%]",children:"Request Qnty"}),e.jsx(n,{className:"w-[10%]",children:"Issued Qnty"}),e.jsx(n,{className:"w-[10%]",children:"Stock "}),e.jsx(n,{className:"w-[10%]",children:"Issue"})]})}),e.jsx(R,{children:S==null?void 0:S.map(s=>e.jsxs(b,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(je,{size:"md",shape:"round",src:s.img_url}),e.jsx("span",{children:s.name})]})}),e.jsxs(i,{children:["â‚¹",s.amount]}),e.jsx(i,{children:s.quantity}),e.jsx(i,{children:s.issued}),e.jsx(i,{children:s.balance<s.quantity-s.issued?e.jsx(p,{content:s.balance,innerClass:"bg-red-500"}):e.jsx(p,{content:s.balance,innerClass:"bg-green-500"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{type:"button",icon:e.jsx(be,{}),size:"xs",onClick:()=>Q(s)}),e.jsx("div",{className:"w-10 text-center",children:e.jsx("span",{children:s.issue})}),e.jsx(f,{type:"button",icon:e.jsx(Ce,{}),size:"xs",onClick:()=>F(s)})]})})]},s.id))})]})})})}),e.jsx(f,{block:!0,type:"button",variant:"solid",onClick:()=>J(S[0].order_id),loading:W,children:"ISSUE"})]}),e.jsx(pe,{isOpen:E,title:"Order Confirmation",onClose:j,onRequestClose:j,onCancel:j,onConfirm:X,children:e.jsxs("p",{children:["Are you sure you want confirm this? This action can't be undo."," "]})})]})};export{Le as default};
