import{Y as L,r as o,j as e,c as V,u as w,W as E,R as A,T as F,P as R}from"./index-CZgPydMj.js";import{B as u}from"./Button-BT2_m6mH.js";import{t as S,N as b}from"./toast-BT-0uNo3.js";import{C as I}from"./ConfirmDialog-Cm8n770u.js";import{u as z,F as K}from"./index.esm-zMN7Sbju.js";import{B as M}from"./BottomStickyBar-BKnwhhXG.js";import{C as W}from"./Card-DJK2Rlpr.js";import{D as _}from"./Dialog-D2WEWJR2.js";import{A as G,N as C,C as H}from"./react-number-format.es-1nEpKj12.js";import{A as D}from"./index-BlgRK57S.js";import{T as B}from"./index-D8VYR53w.js";import{S as Q}from"./ScrollBar--sbhryXM.js";import{u as Y,e as $,f as J,g as U,h as X}from"./useResponsive-BiKeaHku.js";import"./classNames-CRMUo2Ju.js";import"./StatusIcon-DEzrEDoH.js";import"./index-C4qm-TqH.js";import"./CloseButton-BhBUV9lS.js";import"./isNil-DCXEAzbG.js";import"./_getPrototype-DfzR1bwp.js";import"./floating-ui.dom-DpEFFCFL.js";const Z={productList:[],selectedProduct:[]},O=L(n=>({...Z,setProductList:a=>n(()=>({productList:a})),setSelectedProduct:a=>n(()=>({selectedProduct:a}))})),{Tr:T,Th:P,Td:f,THead:ee,TBody:se}=B,te=()=>{const{productList:n,selectedProduct:a,setSelectedProduct:l}=O(),[g,d]=o.useState(""),[m,c]=o.useState(!1),{smaller:v}=Y(),y=s=>{const t=n.find(r=>r.id===s.id);if(t){if(a.some(r=>r.id===t.id))return;a.push({...t,quantity:1}),l(a)}},p=s=>{l(a.map(t=>(t.id===s.id&&(t.quantity=t.quantity+1),t)))},x=s=>{const t=s;t.quantity=t.quantity-1,t.quantity===0?l(a.filter(r=>r.id!==t.id)):l(a.map(r=>(r.id===t.id&&(r=t),r)))},N=(s,t)=>{s?(a.push({...t,quantity:1}),l(a)):l(a.filter(r=>r.id!==t.id))},h=o.useMemo(()=>a.reduce((s,t)=>s+t.amount*t.quantity,0),[a,a.length]),j=o.useMemo(()=>a.reduce((s,t)=>s+t.pv*t.quantity,0),[a,a.length]);return e.jsxs(e.Fragment,{children:[e.jsxs(W,{id:"selectProducts",children:[e.jsx("h4",{className:"mb-6",children:"Select products"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{data:n,optionKey:s=>s.name,value:g,renderOption:s=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["PV: ",s.pv]})]})]}),e.jsxs("div",{children:["Stock:",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]}),suffix:e.jsx($,{className:"text-lg"}),placeholder:"Search product",onInputChange:d,onOptionSelected:y}),e.jsx(u,{type:"button",variant:"solid",onClick:()=>c(!0),children:"Browse products"})]}),e.jsxs(B,{compact:v.sm,className:"mt-6",children:[e.jsx(ee,{children:e.jsxs(T,{children:[e.jsx(P,{className:"w-[70%]",children:"Product"}),e.jsx(P,{children:"Price"}),e.jsx(P,{children:"Quantity"}),e.jsx(P,{children:"Total"})]})}),e.jsx(se,{children:a.length>0?a.map(s=>e.jsxs(T,{children:[e.jsx(f,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("div",{className:"heading-text font-bold",children:s.name}),e.jsxs("div",{children:["PV: ",s.pv]})]})]})}),e.jsx(f,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(C,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount,decimalScale:2,thousandSeparator:!0})})}),e.jsx(f,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{type:"button",icon:e.jsx(J,{}),size:"xs",onClick:()=>x(s)}),e.jsx("div",{className:"w-10 text-center",children:e.jsx("span",{children:s.quantity})}),e.jsx(u,{type:"button",icon:e.jsx(U,{}),size:"xs",onClick:()=>p(s)})]})}),e.jsx(f,{children:e.jsx("div",{className:"heading-text font-bold",children:e.jsx(C,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount*s.quantity,decimalScale:2,thousandSeparator:!0})})})]},s.id)):e.jsx(T,{children:e.jsx(f,{className:"text-center",colSpan:4,children:"No product selected!"})})})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Total PV: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(C,{fixedDecimalScale:!0,displayType:"text",value:j,decimalScale:2})})]}),e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Grand Total: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(C,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:h,decimalScale:2,thousandSeparator:!0})})]})]})]}),e.jsxs(_,{isOpen:m,onClose:()=>c(!1),onRequestClose:()=>c(!1),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h4",{className:"mb-1",children:"All products"}),e.jsx("p",{children:"Add products to this order."})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(Q,{className:V("overflow-y-auto h-80"),children:n.map(s=>e.jsxs("div",{className:"py-3 pr-5 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-1",children:e.jsx(H,{checked:a.some(t=>t.id===s.id),onChange:t=>N(t,s)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{size:"lg",shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["PV: ",s.pv]})]})]})]}),e.jsxs("div",{children:["Stock:"," ",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]},s.id))})})}),e.jsx(u,{block:!0,type:"button",variant:"solid",onClick:()=>c(!1),children:"Done"})]})]})};async function ae(n){return F.fetchDataWithAxios({url:`/get-product-list/${n}`,method:"get"})}const re=n=>{const[a,l]=o.useState(!0),[g,d]=o.useState(null),{onFormSubmit:m,children:c,defaultValues:v,defaultProducts:y}=n,{setProductList:p,setSelectedProduct:x}=O(),{user:N}=w();o.useEffect(()=>{ae(N.id).then(i=>{p(i)}).catch(i=>{var q;d(((q=i==null?void 0:i.response)==null?void 0:q.data)||i.toString())}).finally(()=>{l(!1)})},[]);const h=i=>{m==null||m(i)};function j(i){i.key==="Enter"&&i.preventDefault()}const{handleSubmit:s,reset:t,watch:r,formState:{errors:k},control:ie}=z();return e.jsx("div",{className:"flex",children:a?e.jsx(E,{loading:!0}):e.jsxs(K,{className:"flex-1 flex flex-col overflow-hidden",onSubmit:s(h),onKeyDown:j,children:[e.jsx(A,{children:e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(te,{})})})}),e.jsx(M,{children:c})]})})};async function ne(n){return F.fetchDataWithAxios({url:"/create-order",method:"post",data:n})}const Te=()=>{R();const{user:n}=w(),{setSelectedProduct:a,selectedProduct:l}=O(),[g,d]=o.useState(!1),[m,c]=o.useState(!1),v=async N=>{var s,t;c(!0);const h=l.map(({id:r,quantity:k})=>({id:r,quantity:k}));if(!h.length){S.push(e.jsx(b,{type:"danger",children:"Please select at least one product to create an order."}),{placement:"top-center"}),c(!1);return}const j={id:n.id,products:h};try{await ne(j)&&(S.push(e.jsx(b,{type:"success",children:"Order Placed!"}),{placement:"top-center"}),a([]))}catch(r){S.push(e.jsx(b,{type:"danger",children:((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)||r.message.toString()||r.toString()}),{placement:"top-center"})}c(!1)},y=()=>{d(!1),a([]),S.push(e.jsx(b,{type:"success",children:"Order discarded!"}),{placement:"top-center"})},p=()=>{d(!0)},x=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(re,{onFormSubmit:v,children:e.jsx(A,{children:e.jsxs("div",{className:"flex items-center justify-between px-8",children:[e.jsx("span",{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(u,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:e.jsx(X,{}),onClick:p,children:"Discard"}),e.jsx(u,{variant:"solid",type:"submit",loading:m,children:"Create"})]})]})})}),e.jsx(I,{isOpen:g,type:"danger",title:"Discard changes",onClose:x,onRequestClose:x,onCancel:x,onConfirm:y,children:e.jsxs("p",{children:["Are you sure you want discard this? This action can't be undo."," "]})})]})};export{Te as default};
