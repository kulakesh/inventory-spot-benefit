import{Y as V,r as o,j as e,c as I,u as A,W as _,R as F,T as R,P as E}from"./index-BiL_6wO1.js";import{B as f}from"./Button-BDZQFRVN.js";import{t as P,N as D}from"./toast-BTFS_ymD.js";import{C as z}from"./ConfirmDialog-1aUNlPH0.js";import{u as K,F as M}from"./index.esm-DPWQZQZL.js";import{B as W}from"./BottomStickyBar-DKhIVgb9.js";import{C as G}from"./Card-DhvR2on-.js";import{B as j,D as H}from"./Dialog-DwdWHXbu.js";import{A as Q,N as T,C as Y}from"./react-number-format.es-Ma7y7UTr.js";import{I as $}from"./Input-Kt4_5zsU.js";import{A as B}from"./index-CWPX1wR9.js";import{T as L}from"./index-jYUq1LG-.js";import{S as J}from"./ScrollBar-VDxaIlEs.js";import{u as U,e as X,f as Z,g as ee,h as se}from"./useResponsive-Ub9y9uDy.js";import"./classNames-CzwFyL_p.js";import"./StatusIcon-Dnu0aB1O.js";import"./index-DTyhqsPu.js";import"./CloseButton-DCv1qkuF.js";import"./index-BWRR-Til.js";import"./_getPrototype-DlX6t2G5.js";import"./useMergeRef-Cw6AoeWY.js";import"./floating-ui.dom-DvzLbbXS.js";import"./toString-BKJBPJYD.js";import"./isNil-CT_EA3jS.js";const te={productList:[],selectedProduct:[]},k=V(r=>({...te,setProductList:a=>r(()=>({productList:a})),setSelectedProduct:a=>r(()=>({selectedProduct:a}))})),{Tr:O,Th:q,Td:y,THead:ae,TBody:ne}=L,re=()=>{const{productList:r,selectedProduct:a,setSelectedProduct:i}=k(),[N,d]=o.useState(""),[m,c]=o.useState(!1),{smaller:v}=U(),S=s=>{const t=r.find(n=>n.id===s.id);if(t){if(a.some(n=>n.id===t.id))return;a.push({...t,quantity:1}),i(a)}},g=s=>{i(a.map(t=>(t.id===s.id&&(t.quantity=t.quantity+1),t)))},x=s=>{const t=s;t.quantity=t.quantity-1,t.quantity===0?i(a.filter(n=>n.id!==t.id)):i(a.map(n=>(n.id===t.id&&(n=t),n)))},C=(s,t)=>{const n=s;n.quantity=t.target.valueAsNumber,n.quantity===0?i(a.filter(p=>p.id!==n.id)):i(a.map(p=>(p.id===n.id&&(p=n),p)))},u=(s,t)=>{s?(a.push({...t,quantity:1}),i(a)):i(a.filter(n=>n.id!==t.id))},b=o.useMemo(()=>a.reduce((s,t)=>s+t.amount*t.quantity,0),[a,a.length]),h=o.useMemo(()=>a.reduce((s,t)=>s+t.bv*t.quantity,0),[a,a.length]);return e.jsxs(e.Fragment,{children:[e.jsxs(G,{id:"selectProducts",children:[e.jsx("h4",{className:"mb-6",children:"Select products"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{data:r,optionKey:s=>s.name,value:N,renderOption:s=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["BV: ",s.bv,s.category_id===1?e.jsx(j,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(j,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]}),e.jsxs("div",{children:["Stock:",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]}),suffix:e.jsx(X,{className:"text-lg"}),placeholder:"Search product",onInputChange:d,onOptionSelected:S}),e.jsx(f,{type:"button",variant:"solid",onClick:()=>c(!0),children:"Browse products"})]}),e.jsxs(L,{compact:v.sm,className:"mt-6",children:[e.jsx(ae,{children:e.jsxs(O,{children:[e.jsx(q,{className:"w-[70%]",children:"Product"}),e.jsx(q,{children:"Price"}),e.jsx(q,{children:"Quantity"}),e.jsx(q,{children:"Total"})]})}),e.jsx(ne,{children:a.length>0?a.map(s=>e.jsxs(O,{children:[e.jsx(y,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("div",{className:"heading-text font-bold",children:s.name}),e.jsxs("div",{children:["BV: ",s.bv,s.category_id===1?e.jsx(j,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(j,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]})}),e.jsx(y,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(T,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount,decimalScale:2,thousandSeparator:!0})})}),e.jsx(y,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{type:"button",icon:e.jsx(Z,{}),size:"xs",onClick:()=>x(s)}),e.jsx("div",{className:"w-15 text-center",children:e.jsx($,{type:"number",autoComplete:"off",value:s.quantity,className:"text-center",onChange:t=>C(s,t)})}),e.jsx(f,{type:"button",icon:e.jsx(ee,{}),size:"xs",onClick:()=>g(s)})]})}),e.jsx(y,{children:e.jsx("div",{className:"heading-text font-bold",children:e.jsx(T,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount*s.quantity,decimalScale:2,thousandSeparator:!0})})})]},s.id)):e.jsx(O,{children:e.jsx(y,{className:"text-center",colSpan:4,children:"No product selected!"})})})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Total BV: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(T,{fixedDecimalScale:!0,displayType:"text",value:h,decimalScale:2})})]}),e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Grand Total: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(T,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:b,decimalScale:2,thousandSeparator:!0})})]})]})]}),e.jsxs(H,{isOpen:m,onClose:()=>c(!1),onRequestClose:()=>c(!1),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h4",{className:"mb-1",children:"All products"}),e.jsx("p",{children:"Add products to this order."})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(J,{className:I("overflow-y-auto h-80"),children:r.map(s=>e.jsxs("div",{className:"py-3 pr-5 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-1",children:e.jsx(Y,{checked:a.some(t=>t.id===s.id),onChange:t=>u(t,s)})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{size:"lg",shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["BV: ",s.bv,s.category_id===1?e.jsx(j,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(j,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]})]}),e.jsxs("div",{children:["Stock:"," ",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]},s.id))})})}),e.jsx(f,{block:!0,type:"button",variant:"solid",onClick:()=>c(!1),children:"Done"})]})]})};async function ie(r){return R.fetchDataWithAxios({url:`/get-product-list/${r}`,method:"get"})}const le=r=>{const[a,i]=o.useState(!0),[N,d]=o.useState(null),{onFormSubmit:m,children:c,defaultValues:v,defaultProducts:S}=r,{setProductList:g,setSelectedProduct:x}=k(),{user:C}=A();o.useEffect(()=>{ie(C.id).then(l=>{g(l)}).catch(l=>{var w;d(((w=l==null?void 0:l.response)==null?void 0:w.data)||l.toString())}).finally(()=>{i(!1)})},[]);const u=l=>{m==null||m(l)};function b(l){l.key==="Enter"&&l.preventDefault()}const{handleSubmit:h,reset:s,watch:t,formState:{errors:n},control:p}=K();return e.jsx("div",{className:"flex",children:a?e.jsx(_,{loading:!0}):e.jsxs(M,{className:"flex-1 flex flex-col overflow-hidden",onSubmit:h(u),onKeyDown:b,children:[e.jsx(F,{children:e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(re,{})})})}),e.jsx(W,{children:c})]})})};async function ce(r){return R.fetchDataWithAxios({url:"/create-order",method:"post",data:r})}const Ae=()=>{E();const{user:r}=A(),{setSelectedProduct:a,selectedProduct:i}=k(),[N,d]=o.useState(!1),[m,c]=o.useState(!1),v=async C=>{var h,s;c(!0);const u=i.map(({id:t,quantity:n})=>({id:t,quantity:n}));if(!u.length){P.push(e.jsx(D,{type:"danger",children:"Please select at least one product to create an order."}),{placement:"top-center"}),c(!1);return}const b={id:r.id,products:u};try{await ce(b)&&(P.push(e.jsx(D,{type:"success",children:"Order Placed!"}),{placement:"top-center"}),a([]))}catch(t){P.push(e.jsx(D,{type:"danger",children:((s=(h=t==null?void 0:t.response)==null?void 0:h.data)==null?void 0:s.message)||t.message.toString()||t.toString()}),{placement:"top-center"})}c(!1)},S=()=>{d(!1),a([]),P.push(e.jsx(D,{type:"success",children:"Order discarded!"}),{placement:"top-center"})},g=()=>{d(!0)},x=()=>{d(!1)};return e.jsxs(e.Fragment,{children:[e.jsx(le,{onFormSubmit:v,children:e.jsx(F,{children:e.jsxs("div",{className:"flex items-center justify-between px-8",children:[e.jsx("span",{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(f,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:e.jsx(se,{}),onClick:g,children:"Discard"}),e.jsx(f,{variant:"solid",type:"submit",loading:m,children:"Create"})]})]})})}),e.jsx(z,{isOpen:N,type:"danger",title:"Discard changes",onClose:x,onRequestClose:x,onCancel:x,onConfirm:S,children:e.jsxs("p",{children:["Are you sure you want discard this? This action can't be undo."," "]})})]})};export{Ae as default};
