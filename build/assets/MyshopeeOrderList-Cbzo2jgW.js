import{V as K,P as Z,r as o,u as $,j as e,X as ee,c as se,T as I}from"./index-yh3mfxzJ.js";import{T as N}from"./index-BIRH_YRj.js";import{u as ae,g as te,a as ne,b as ie,c as re,T as le,P as oe}from"./index-DhSHXsfg.js";import{S as ce}from"./Select-Y3Xe42QZ.js";import{l as de,g as me}from"./index-BHnhLCbU.js";import{C as he}from"./Card-D6bFxUwa.js";import{B as x}from"./Button-Cu21tS-Q.js";import{B as g}from"./Badge-Dk1sjP5P.js";import{T as ue,A as xe}from"./index-B3_UeuDl.js";import{D as ge}from"./Dialog-DZf8Prr5.js";import{S as je}from"./ScrollBar-1pk9O7IT.js";import{C as fe}from"./ConfirmDialog-CEiJLxUb.js";import{u as pe,f as Se,g as be}from"./useResponsive-dAG-breB.js";import{t as w,N as P}from"./toast-BP8GGVCQ.js";import"./classNames-B_J8Bb5h.js";import"./useControllableState-C0z_sNIq.js";import"./floating-ui.dom-oVtnDDg4.js";import"./CloseButton-DZ0NwoaT.js";import"./StatusIcon-WbxDcp4s.js";const{Tr:S,Th:i,Td:r,THead:T,TBody:R}=N;async function Ce(c,d){const h=c?"/get-order-history/":"/sku-order-list/"+d;return I.fetchDataWithAxios({url:h,method:"get"})}async function ve(c){return I.fetchDataWithAxios({url:"/sku-order-confirm",method:"post",data:c})}const O=[{value:10,label:"10 / page"},{value:20,label:"20 / page"},{value:30,label:"30 / page"},{value:40,label:"40 / page"},{value:50,label:"50 / page"}],Ne=[e.jsx(g,{className:"mr-4",content:"Pending",innerClass:"bg-white text-gray-500"}),"Deleted",e.jsx(g,{className:"mr-4",content:"Complete",innerClass:"bg-emerald-500"})],Ue=()=>{const{history:c}=K();Z();const[d,h]=o.useState([]),[M,z]=o.useState(!0),[u,k]=o.useState(null),[j,A]=o.useState([]),[_,f]=o.useState(!1),[q,b]=o.useState(!1),[C,v]=o.useState(null),[B,D]=o.useState(!1),[De,ye]=o.useState(!1),{user:E}=$(),{smaller:W}=pe();o.useEffect(()=>{y()},[]);const y=()=>{Ce(c,E.id).then(s=>{h(s)}).catch(s=>{var l,n;k(((n=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:n.message)||s.toString())}).finally(()=>{z(!1)})},Y=s=>{const l=d.map(n=>(n.id===s.order_id&&n.items.map(a=>{if(a.id===s.id){const t=a.issue?a.issue+1:1;t<=a.quantity-a.issued&&t<=a.balance&&(a.issue=t)}return a}),n));h(l)},H=s=>{const l=d.map(n=>(n.id===s.order_id&&n.items.map(a=>{if(a.id===s.id){const t=a.issue?a.issue-1:0;t>=0&&(a.issue=t)}return a}),n));h(l)},F=d.length,m=ae({data:d,getCoreRowModel:re(),getFilteredRowModel:ie(),getPaginationRowModel:ne(),getSortedRowModel:te()}),Q=s=>{m.setPageIndex(s-1)},U=(s=0)=>{m.setPageSize(Number(s))},V=s=>{A(s),f(!0)},G=async()=>{var n,a;if(!C)return;D(!0);var s=[];d.map(t=>{t.id===C&&(s=t.items.map(({id:X,issue:J})=>({id:X,issue:J})))});const l={order_id:C,order_items:s};try{await ve(l)&&(b(!1),f(!1),v(null),w.push(e.jsx(P,{type:"success",children:"Order fullfilled!"}),{placement:"top-center"}),y())}catch(t){console.error("Error confirming order:",t),w.push(e.jsx(P,{type:"danger",children:((a=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:a.message)||t.message.toString()||t.toString()}),{placement:"top-center"})}D(!1),p()},L=s=>{b(!0),v(s)},p=()=>{b(!1),v(null)};return u?e.jsx("div",{children:u||(u==null?void 0:u.message)}):e.jsxs("div",{children:[e.jsxs(he,{children:[e.jsxs(N,{children:[e.jsx(T,{children:e.jsxs(S,{children:[e.jsx(i,{children:"Sl No"}),e.jsx(i,{children:"User ID"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Date"}),c?null:e.jsx(i,{children:"Action"})]})}),M?e.jsx(le,{columns:9,rows:10,avatarInColumns:[5,6,8],avatarProps:{width:28,height:28}}):e.jsx(R,{children:m.getRowModel().rows.map(s=>{var l,n;return e.jsxs(S,{children:[e.jsx(r,{children:s.index+1}),e.jsx(r,{children:(l=s.original.user)==null?void 0:l.user_id}),e.jsx(r,{children:(n=s.original.user)==null?void 0:n.name}),e.jsx(r,{children:s.original.amount}),e.jsx(r,{children:Ne[s.original.status]}),e.jsx(r,{children:ee.unix(s.original.created_at).format("D MMM, YYYY h:mm a")}),c?null:e.jsx(r,{children:e.jsxs("div",{className:"flex justify-end text-lg gap-1",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(g,{className:"mr-2",innerClass:"bg-blue-500",content:s.original.items.length,children:e.jsx(ue,{title:"View items",children:e.jsx(x,{onClick:()=>V(s.original.items),shape:"circle",size:"sm",icon:e.jsx(de,{})})})})}),e.jsx(x,{icon:e.jsx(me,{}),variant:"plain",size:"xs",className:"bg-error text-white"})]})})]},s.original.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(oe,{pageSize:m.getState().pagination.pageSize,currentPage:m.getState().pagination.pageIndex+1,total:F,onChange:Q}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ce,{size:"sm",isSearchable:!1,value:O.filter(s=>s.value===m.getState().pagination.pageSize),options:O,onChange:s=>U(s==null?void 0:s.value)})})]})]}),e.jsxs(ge,{isOpen:_,onClose:()=>f(!1),onRequestClose:()=>f(!1),width:850,children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h4",{className:"mb-1",children:"Ordered items"})}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(je,{className:se("overflow-y-auto h-120"),children:e.jsxs(N,{compact:W.sm,className:"mt-6",children:[e.jsx(T,{children:e.jsxs(S,{children:[e.jsx(i,{className:"w-[40%]",children:"Product"}),e.jsx(i,{className:"w-[20%]",children:"Price"}),e.jsx(i,{className:"w-[10%]",children:"Request Qnty"}),e.jsx(i,{className:"w-[10%]",children:"Issued Qnty"}),e.jsx(i,{className:"w-[10%]",children:"Stock "}),e.jsx(i,{className:"w-[10%]",children:"Issue"})]})}),e.jsx(R,{children:j==null?void 0:j.map(s=>e.jsxs(S,{children:[e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{size:"md",shape:"round",src:s.img_url}),e.jsx("span",{children:s.name})]})}),e.jsxs(r,{children:["â‚¹",s.amount]}),e.jsx(r,{children:s.quantity}),e.jsx(r,{children:s.issued}),e.jsx(r,{children:s.balance<s.quantity?e.jsx(g,{content:s.balance,innerClass:"bg-red-500"}):e.jsx(g,{content:s.balance,innerClass:"bg-green-500"})}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(x,{type:"button",icon:e.jsx(Se,{}),size:"xs",onClick:()=>H(s)}),e.jsx("div",{className:"w-10 text-center",children:e.jsx("span",{children:s.issue})}),e.jsx(x,{type:"button",icon:e.jsx(be,{}),size:"xs",onClick:()=>Y(s)})]})})]},s.id))})]})})})}),e.jsx(x,{block:!0,type:"button",variant:"solid",onClick:()=>L(j[0].order_id),loading:B,children:"ISSUE"})]}),e.jsx(fe,{isOpen:q,title:"Order Confirmation",onClose:p,onRequestClose:p,onCancel:p,onConfirm:G,children:e.jsxs("p",{children:["Are you sure you want confirm this? This action can't be undo."," "]})})]})};export{Ue as default};
