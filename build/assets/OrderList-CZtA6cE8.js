import{V as Y,P as q,r as t,j as e,X as W,c as F,T as D}from"./index-DCPqOy_K.js";import{T as y}from"./index-BHiLbOvw.js";import{u as V,T as _,P as G,g as L,a as Q,b as U,c as X}from"./index-ApTIgoNO.js";import{S as $}from"./Select-Bd5MjwGl.js";import{f as J,m as K,h as Z}from"./index-exMPUQYN.js";import{C as ee}from"./Card-Dc9KbVWq.js";import{B as h}from"./Button-BU3EFbPR.js";import{B as f}from"./Badge-B8LCAcMI.js";import{T as se,A as ae}from"./index-DFdBwQaq.js";import{D as te}from"./Dialog-BtZrEhlE.js";import{S as ie}from"./ScrollBar-DCzP_xq4.js";import{C as ne}from"./ConfirmDialog-DPYvWE8C.js";import"./useControllableState-BGc53vJX.js";import"./floating-ui.dom-DBMUmEx0.js";import"./CloseButton-Br0ECf1e.js";const{Tr:b,Th:i,Td:n,THead:re,TBody:le}=y;async function oe(o){const c=o?"/get-order-history":"/get-order-list";return D.fetchDataWithAxios({url:c,method:"get"})}const N=[{value:10,label:"10 / page"},{value:20,label:"20 / page"},{value:30,label:"30 / page"},{value:40,label:"40 / page"},{value:50,label:"50 / page"}],ce=[e.jsx(f,{className:"mr-4",content:"Pending",innerClass:"bg-white text-gray-500"}),"Deleted",e.jsx(f,{className:"mr-4",content:"Complete",innerClass:"bg-emerald-500"})],ye=()=>{const{history:o}=Y();q();const[c,p]=t.useState([]),[P,T]=t.useState(!0),[C,O]=t.useState(null),[g,R]=t.useState([]),[w,d]=t.useState(!1),[M,x]=t.useState(!1),[u,j]=t.useState(null),[z,S]=t.useState(!1);t.useEffect(()=>{oe(o).then(s=>{p(s)}).catch(s=>{var r,a;O(((a=(r=s==null?void 0:s.response)==null?void 0:r.data)==null?void 0:a.message)||s.toString())}).finally(()=>{T(!1)})},[]);const I=c.length,l=V({data:c,getCoreRowModel:X(),getFilteredRowModel:U(),getPaginationRowModel:Q(),getSortedRowModel:L()}),A=s=>{l.setPageIndex(s-1)},k=(s=0)=>{l.setPageSize(Number(s))},B=s=>{R(s),d(!0)},E=()=>{u&&(S(!0),D.fetchDataWithAxios({url:`/confirm-order/${u}`,method:"get"}).then(s=>{s&&(x(!1),j(null),p(r=>r.map(a=>a.id===u?{...a,status:2}:a)))}).catch(s=>{console.error("Error confirming order:",s)}).finally(()=>{S(!1)}),m())},H=s=>{x(!0),j(s)},m=()=>{x(!1),j(null)};return C?e.jsx("div",{children:C.message}):e.jsxs("div",{children:[e.jsxs(ee,{children:[e.jsxs(y,{children:[e.jsx(re,{children:e.jsxs(b,{children:[e.jsx(i,{children:"Sl No"}),e.jsx(i,{children:"ID"}),e.jsx(i,{children:"Username"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Items"}),e.jsx(i,{children:"Date"}),o?null:e.jsx(i,{children:"Action"})]})}),P?e.jsx(_,{columns:9,rows:10,avatarInColumns:[5,6,8],avatarProps:{width:28,height:28}}):e.jsx(le,{children:l.getRowModel().rows.map(s=>{var r,a,v;return e.jsxs(b,{children:[e.jsx(n,{children:s.index+1}),e.jsx(n,{children:(r=s.original.user)==null?void 0:r.id}),e.jsx(n,{children:(a=s.original.user)==null?void 0:a.username}),e.jsx(n,{children:(v=s.original.user)==null?void 0:v.name}),e.jsx(n,{children:s.original.amount}),e.jsx(n,{children:ce[s.original.status]}),e.jsx(n,{children:e.jsx("div",{className:"flex items-center",children:e.jsx(f,{className:"mr-2",innerClass:"bg-blue-500",content:s.original.items.length,children:e.jsx(se,{title:"View items",children:e.jsx(h,{onClick:()=>B(s.original.items),shape:"circle",size:"sm",icon:e.jsx(J,{})})})})})}),e.jsx(n,{children:W.unix(s.original.created_at).format("D MMM, YYYY h:mm a")}),o?null:e.jsx(n,{children:e.jsxs("div",{className:"flex justify-end text-lg gap-1",children:[e.jsx(h,{onClick:()=>H(s.original.id),icon:e.jsx(K,{}),loading:z,variant:"solid",size:"xs"}),e.jsx(h,{icon:e.jsx(Z,{}),variant:"plain",size:"xs",className:"bg-error text-white"})]})})]},s.original.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(G,{pageSize:l.getState().pagination.pageSize,currentPage:l.getState().pagination.pageIndex+1,total:I,onChange:A}),e.jsx("div",{style:{minWidth:130},children:e.jsx($,{size:"sm",isSearchable:!1,value:N.filter(s=>s.value===l.getState().pagination.pageSize),options:N,onChange:s=>k(s==null?void 0:s.value)})})]})]}),e.jsxs(te,{isOpen:w,onClose:()=>d(!1),onRequestClose:()=>d(!1),children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h4",{className:"mb-1",children:"Ordered items"})}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(ie,{className:F("overflow-y-auto h-80"),children:g==null?void 0:g.map(s=>e.jsxs("div",{className:"py-3 pr-5 rounded-lg flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{size:"lg",shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["Price: â‚¹",s.amount]})]})]})}),e.jsxs("div",{children:["Qnt:",e.jsx("span",{className:"heading-text font-bold",children:s.quantity})]})]},s.id))})})}),e.jsx(h,{block:!0,type:"button",variant:"solid",onClick:()=>d(!1),children:"Close"})]}),e.jsx(ne,{isOpen:M,title:"Order Confirmation",onClose:m,onRequestClose:m,onCancel:m,onConfirm:E,children:e.jsxs("p",{children:["Are you sure you want confirm this? This action can't be undo."," "]})})]})};export{ye as default};
