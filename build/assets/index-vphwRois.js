import{X as G,r as o,j as e,c as Q,u as z,V as H,Q as M,R as L}from"./index-DYjQbdMU.js";import{B as v}from"./Button-COzievky.js";import{t as T,N as B}from"./toast-BKeLf8e-.js";import{C as X}from"./ConfirmDialog-D_5butHw.js";import{C as Y,u as $,F as J}from"./index.esm-BkIgB_jw.js";import{B as Z}from"./BottomStickyBar-BYqsYd8j.js";import{C as U}from"./Card-CjT__r-_.js";import{B as y,D as ee}from"./Dialog-BywRJu51.js";import{I as se}from"./Input-BylJ9_GI.js";import{A as te,N as O,C as K}from"./react-number-format.es-eDmO7kW4.js";import{A as F}from"./index-KzSytksO.js";import{T as W}from"./index-_XlKyga1.js";import{S as ae}from"./ScrollBar-vIcLLNAz.js";import{u as ne,e as re,f as ie,g as le,h as ce}from"./useResponsive-A-64zdJq.js";import{S as oe,c as de,O as me}from"./Select-5w-VqALn.js";import{F as ue,t as xe,z as E}from"./index-DVEwXbqM.js";import{e as I}from"./index-C9k_wq5h.js";import"./classNames-ClmOXRvH.js";import"./StatusIcon-9mFLQExI.js";import"./index-BFu0nb_6.js";import"./CloseButton-BYCWlGA8.js";import"./index-C5Db1Y-3.js";import"./isNil-CkR7oeq0.js";import"./_getPrototype-cKNnRl8g.js";import"./useMergeRef-CWhj-Tjz.js";import"./floating-ui.dom-Bg7EfdP9.js";import"./toString-gYgxW6YO.js";const he={productList:[],selectedProduct:[]},R=G(r=>({...he,setProductList:a=>r(()=>({productList:a})),setSelectedProduct:a=>r(()=>({selectedProduct:a}))})),{Tr:V,Th:A,Td:D,THead:fe,TBody:pe}=W,je=()=>{const{productList:r,selectedProduct:a,setSelectedProduct:i}=R(),[h,f]=o.useState(""),[d,c]=o.useState(!1),{smaller:g}=ne(),b=s=>{const t=r.find(n=>n.id===s.id);if(t){if(a.some(n=>n.id===t.id))return;if(t.balance<=0)return;a.push({...t,quantity:1}),i(a)}},N=s=>{i(a.map(t=>(t.id===s.id&&s.balance>t.quantity&&(t.quantity=t.quantity+1),t)))},S=s=>{const t=s;t.quantity=t.quantity-1,t.quantity===0?i(a.filter(n=>n.id!==t.id)):i(a.map(n=>(n.id===t.id&&(n=t),n)))},C=(s,t)=>{const n=s;n.quantity=t.target.valueAsNumber,n.quantity===0?i(a.filter(m=>m.id!==n.id)):(n.quantity>s.balance&&(n.quantity=s.balance),i(a.map(m=>(m.id===n.id&&(m=n),m))))},P=(s,t)=>{s?(a.push({...t,quantity:1}),i(a)):i(a.filter(n=>n.id!==t.id))},k=o.useMemo(()=>a.reduce((s,t)=>s+t.amount*t.quantity,0),[a,a.length]),j=o.useMemo(()=>a.reduce((s,t)=>s+t.bv*t.quantity,0),[a,a.length]);return e.jsxs(e.Fragment,{children:[e.jsxs(U,{id:"selectProducts",children:[e.jsx("h4",{className:"mb-6",children:"Select products"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(te,{data:r,optionKey:s=>s.name,value:h,renderOption:s=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["BV: ",s.bv,s.category_id===1?e.jsx(y,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(y,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]}),e.jsxs("div",{children:["Stock:",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]}),suffix:e.jsx(re,{className:"text-lg"}),placeholder:"Search product",onInputChange:f,onOptionSelected:b}),e.jsx(v,{type:"button",variant:"solid",onClick:()=>c(!0),children:"Browse products"})]}),e.jsxs(W,{compact:g.sm,className:"mt-6",children:[e.jsx(fe,{children:e.jsxs(V,{children:[e.jsx(A,{className:"w-[70%]",children:"Product"}),e.jsx(A,{children:"Price"}),e.jsx(A,{children:"Quantity"}),e.jsx(A,{children:"Total"})]})}),e.jsx(pe,{children:a.length>0?a.map(s=>e.jsxs(V,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("div",{className:"heading-text font-bold",children:s.name}),e.jsxs("div",{children:["BV: ",s.bv,s.category_id===1?e.jsx(y,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(y,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]})}),e.jsx(D,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(O,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount,decimalScale:2,thousandSeparator:!0})})}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{type:"button",icon:e.jsx(ie,{}),size:"xs",onClick:()=>S(s)}),e.jsx("div",{className:"w-15 text-center",children:e.jsx(se,{type:"number",autoComplete:"off",value:s.quantity,className:"text-center",onChange:t=>C(s,t)})}),e.jsx(v,{type:"button",icon:e.jsx(le,{}),size:"xs",onClick:()=>N(s)})]})}),e.jsx(D,{children:e.jsx("div",{className:"heading-text font-bold",children:e.jsx(O,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount*s.quantity,decimalScale:2,thousandSeparator:!0})})})]},s.id)):e.jsx(V,{children:e.jsx(D,{className:"text-center",colSpan:4,children:"No product selected!"})})})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Total BV: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(O,{fixedDecimalScale:!0,displayType:"text",value:j,decimalScale:2})})]}),e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Grand Total: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(O,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:k,decimalScale:2,thousandSeparator:!0})})]})]})]}),e.jsxs(ee,{isOpen:d,onClose:()=>c(!1),onRequestClose:()=>c(!1),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h4",{className:"mb-1",children:"All products"}),e.jsx("p",{children:"Add products to this order."})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(ae,{className:Q("overflow-y-auto h-80"),children:r.map(s=>e.jsxs("div",{className:"py-3 pr-5 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-1",children:s.balance>0?e.jsx(K,{checked:a.some(t=>t.id===s.id),onChange:t=>P(t,s)}):e.jsx(K,{disabled:!0,checked:!1})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{size:"lg",shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["BV: ",s.bv,s.category_id===1?e.jsx(y,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(y,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]})]}),e.jsxs("div",{children:["Stock:"," ",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]},s.id))})})}),e.jsx(v,{block:!0,type:"button",variant:"solid",onClick:()=>c(!1),children:"Done"})]})]})},{Control:ge}=de,be=r=>e.jsx(me,{...r,customLabel:(a,i)=>e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xl",children:a.icon}),e.jsx("span",{children:i})]})}),Se=({children:r,...a})=>{const i=a.getValue()[0];return e.jsxs(ge,{...a,children:[i&&e.jsx("span",{className:"text-xl ltr:ml-4 rtl:mr-4 text-primary",children:i.icon}),r]})},ye=({control:r,errors:a,selectedSku:i,skuOptions:h})=>{var f;return e.jsxs(U,{id:"sku",children:[e.jsx("h4",{className:"mb-6",children:"SKU"}),e.jsx(ue,{label:"Select SKU",invalid:!!a.sku_id,errorMessage:(f=a.sku_id)==null?void 0:f.message,children:e.jsx(Y,{name:"sku_id",control:r,render:({field:d})=>e.jsx(oe,{options:h,...d,components:{Option:be,Control:Se},placeholder:"",value:h.filter(c=>c.value===d.value),onChange:c=>d.onChange(c==null?void 0:c.value)})})})]})};async function ve(r){return L.fetchDataWithAxios({url:`/get-product-list/${r}`,method:"get"})}async function Ne(){return L.fetchDataWithAxios({url:"/list-sku",method:"get"})}const Ce=E.object({sku_id:E.number().min(1,{message:"SKU required"})}),ke=r=>{const[a,i]=o.useState(!0),[h,f]=o.useState(null),{onFormSubmit:d,children:c,defaultValues:g,defaultProducts:b}=r,[N,S]=o.useState([{label:"SKU Name",value:"sku_id",icon:e.jsx(I,{})},,]),{setProductList:C,setSelectedProduct:P}=R(),{user:k}=z();o.useEffect(()=>{ve(k.id).then(l=>{C(l)}).catch(l=>{var x;f(((x=l==null?void 0:l.response)==null?void 0:x.data)||l.toString())}).finally(()=>{i(!1)}),Ne().then(l=>{S((l==null?void 0:l.filter(x=>x.id!==2).map(x=>({label:x.name,value:x.id,icon:e.jsx(I,{})})))||[])}).catch(l=>{var x;f(((x=l==null?void 0:l.response)==null?void 0:x.data)||l.toString())}).finally(()=>{i(!1)})},[]),o.useEffect(()=>{n({sku_id:""})},[r.refresh]);const j=l=>{d==null||d(l)};function s(l){l.key==="Enter"&&l.preventDefault()}const{handleSubmit:t,reset:n,watch:m,formState:{errors:q},control:u,setValue:p,getValues:_}=$({defaultValues:{sku_id:"",...g||{}},resolver:xe(Ce)}),w=m("sku_id","");return h?e.jsx("div",{children:h.message}):e.jsx("div",{className:"flex",children:a?e.jsx(H,{loading:!0}):e.jsxs(J,{className:"flex-1 flex flex-col overflow-hidden",onSubmit:t(j),onKeyDown:s,children:[e.jsx(M,{children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(je,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(ye,{control:u,errors:q,skuOptions:N,selectedSku:w})})]})})}),e.jsx(Z,{children:c})]})})};async function De(r){return L.fetchDataWithAxios({url:"/create-transfer",method:"post",data:r})}const es=()=>{const{user:r}=z(),{setSelectedProduct:a,selectedProduct:i,setProductList:h,productList:f}=R(),[d,c]=o.useState(!1),[g,b]=o.useState(!1),[N,S]=o.useState(!0),C=async s=>{var m,q;b(!0);const t=i.map(({id:u,quantity:p})=>({id:u,quantity:p}));if(!t.length){T.push(e.jsx(B,{type:"danger",children:"Please select at least one product to create an order."}),{placement:"top-center"}),b(!1);return}const n={id:r.id,sku:s,products:t};try{await De(n)&&(T.push(e.jsx(B,{type:"success",children:"Stock Transferred!"}),{placement:"top-center"}),h(f.map(p=>{const _=i.find(w=>w.id===p.id);return _&&(p.balance=p.balance-_.quantity),p})),a([]),S(p=>!p))}catch(u){T.push(e.jsx(B,{type:"danger",children:((q=(m=u==null?void 0:u.response)==null?void 0:m.data)==null?void 0:q.message)||u.message.toString()||u.toString()}),{placement:"top-center"})}b(!1)},P=()=>{c(!1),a([]),S(s=>!s),T.push(e.jsx(B,{type:"success",children:"Order discarded!"}),{placement:"top-center"})},k=()=>{c(!0)},j=()=>{c(!1)};return r.id!=2?e.jsx("div",{children:"You are not authorized to access this page."}):e.jsxs(e.Fragment,{children:[e.jsx(ke,{onFormSubmit:C,refresh:N,children:e.jsx(M,{children:e.jsxs("div",{className:"flex items-center justify-between px-8",children:[e.jsx("span",{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:e.jsx(ce,{}),onClick:k,children:"Discard"}),e.jsx(v,{variant:"solid",type:"submit",loading:g,children:"Create"})]})]})})}),e.jsx(X,{isOpen:d,type:"danger",title:"Discard changes",onClose:j,onRequestClose:j,onCancel:j,onConfirm:P,children:e.jsxs("p",{children:["Are you sure you want discard this? This action can't be undo."," "]})})]})};export{es as default};
