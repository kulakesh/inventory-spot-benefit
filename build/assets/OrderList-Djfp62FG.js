import{V as $,P as G,r as t,j as e,X as L,c as Q,T as b}from"./index-CZtjPvJ4.js";import{T as R}from"./index-ClRc5ACL.js";import{u as U,T as X,P as J,g as K,a as Z,b as ee,c as se}from"./index-64zU6N20.js";import{S as ae}from"./Select-C_onTc2Z.js";import{e as te,l as ne,g as ie}from"./index-TtNNhmIr.js";import{C as le}from"./Card-DhOi8sr1.js";import{B as j}from"./Button-B1TureNB.js";import{B as v,D as re}from"./Dialog-DM1qDp_-.js";import{T as oe,A as ce}from"./index-UPzM3flb.js";import{S as de}from"./ScrollBar-D3ZUvQY3.js";import{C as O}from"./ConfirmDialog-CiRNUH8E.js";import"./classNames-YaQo_XSq.js";import"./useControllableState-BROaXCl2.js";import"./floating-ui.dom-CrYtpZAi.js";import"./CloseButton-C21If-Yh.js";import"./index-Dskg1t9S.js";import"./useMergeRef-DSPgMaPZ.js";const{Tr:T,Th:i,Td:l,THead:me,TBody:he}=R;async function ge(d){const m=d?"/get-order-history":"/get-order-list";return b.fetchDataWithAxios({url:m,method:"get"})}const P=[{value:10,label:"10 / page"},{value:20,label:"20 / page"},{value:30,label:"30 / page"},{value:40,label:"40 / page"},{value:50,label:"50 / page"}],ue=[e.jsx(v,{className:"mr-4",content:"Pending",innerClass:"bg-white text-gray-500"}),"Deleted",e.jsx(v,{className:"mr-4",content:"Complete",innerClass:"bg-emerald-500"})],ze=()=>{const{history:d}=$();G();const[m,p]=t.useState([]),[w,M]=t.useState(!0),[C,z]=t.useState(null),[S,A]=t.useState([]),[I,h]=t.useState(!1),[k,g]=t.useState(!1),[E,D]=t.useState(!1),[r,o]=t.useState(null),[y,u]=t.useState(!1);t.useEffect(()=>{ge(d).then(s=>{p(s)}).catch(s=>{var n,a;z(((a=(n=s==null?void 0:s.response)==null?void 0:n.data)==null?void 0:a.message)||s.toString())}).finally(()=>{M(!1)})},[]);const B=m.length,c=U({data:m,getCoreRowModel:se(),getFilteredRowModel:ee(),getPaginationRowModel:Z(),getSortedRowModel:K()}),q=s=>{c.setPageIndex(s-1)},H=(s=0)=>{c.setPageSize(Number(s))},W=s=>{A(s),h(!0)},Y=()=>{r&&(u(!0),b.fetchDataWithAxios({url:`/confirm-order/${r}`,method:"get"}).then(s=>{s&&(g(!1),o(null),p(n=>n.map(a=>a.id===r?{...a,status:2}:a)))}).catch(s=>{console.error("Error confirming order:",s)}).finally(()=>{u(!1)}),x())},F=()=>{r&&(u(!0),b.fetchDataWithAxios({url:`/cancel-order/${r}`,method:"get"}).then(s=>{s&&(g(!1),o(null),p(n=>n.filter(a=>a.id!==r)))}).catch(s=>{console.error("Error cancelling order:",s)}).finally(()=>{u(!1)}),f())},V=s=>{g(!0),o(s)},x=()=>{g(!1),o(null)},_=s=>{D(!0),o(s)},f=()=>{D(!1),o(null)};return C?e.jsx("div",{children:C||C.message}):e.jsxs("div",{children:[e.jsxs(le,{children:[e.jsxs(R,{children:[e.jsx(me,{children:e.jsxs(T,{children:[e.jsx(i,{children:"Sl No"}),e.jsx(i,{children:"ID"}),e.jsx(i,{children:"Username"}),e.jsx(i,{children:"Name"}),e.jsx(i,{children:"Amount"}),e.jsx(i,{children:"Status"}),e.jsx(i,{children:"Items"}),e.jsx(i,{children:"Date"}),d?null:e.jsx(i,{children:"Action"})]})}),w?e.jsx(X,{columns:9,rows:10,avatarInColumns:[5,6,8],avatarProps:{width:28,height:28}}):e.jsx(he,{children:c.getRowModel().rows.map(s=>{var n,a,N;return e.jsxs(T,{children:[e.jsx(l,{children:s.index+1}),e.jsx(l,{children:(n=s.original.user)==null?void 0:n.id}),e.jsx(l,{children:(a=s.original.user)==null?void 0:a.username}),e.jsx(l,{children:(N=s.original.user)==null?void 0:N.name}),e.jsx(l,{children:s.original.amount}),e.jsx(l,{children:ue[s.original.status]}),e.jsx(l,{children:e.jsx("div",{className:"flex items-center",children:e.jsx(v,{className:"mr-2",innerClass:"bg-blue-500",content:s.original.items.length,children:e.jsx(oe,{title:"View items",children:e.jsx(j,{onClick:()=>W(s.original.items),shape:"circle",size:"sm",icon:e.jsx(te,{})})})})})}),e.jsx(l,{children:L.unix(s.original.created_at).format("D MMM, YYYY h:mm a")}),d?null:e.jsx(l,{children:e.jsxs("div",{className:"flex justify-end text-lg gap-1",children:[e.jsx(j,{onClick:()=>V(s.original.id),icon:e.jsx(ne,{}),loading:y,variant:"solid",size:"xs"}),e.jsx(j,{onClick:()=>_(s.original.id),icon:e.jsx(ie,{}),loading:y,variant:"plain",size:"xs",className:"bg-error text-white"})]})})]},s.original.id)})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx(J,{pageSize:c.getState().pagination.pageSize,currentPage:c.getState().pagination.pageIndex+1,total:B,onChange:q}),e.jsx("div",{style:{minWidth:130},children:e.jsx(ae,{size:"sm",isSearchable:!1,value:P.filter(s=>s.value===c.getState().pagination.pageSize),options:P,onChange:s=>H(s==null?void 0:s.value)})})]})]}),e.jsxs(re,{isOpen:I,onClose:()=>h(!1),onRequestClose:()=>h(!1),children:[e.jsx("div",{className:"text-center mb-6",children:e.jsx("h4",{className:"mb-1",children:"Ordered items"})}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(de,{className:Q("overflow-y-auto h-80"),children:S==null?void 0:S.map(s=>e.jsxs("div",{className:"py-3 pr-5 rounded-lg flex items-center justify-between",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{size:"lg",shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["Price: â‚¹",s.amount]})]})]})}),e.jsxs("div",{children:["Qnt:",e.jsx("span",{className:"heading-text font-bold",children:s.quantity})]})]},s.id))})})}),e.jsx(j,{block:!0,type:"button",variant:"solid",onClick:()=>h(!1),children:"Close"})]}),e.jsx(O,{isOpen:k,title:"Order Confirmation",onClose:x,onRequestClose:x,onCancel:x,onConfirm:Y,children:e.jsxs("p",{children:["Are you sure you want confirm this? This action can't be undo."," "]})}),e.jsx(O,{isOpen:E,title:"Cancel Confirmation",onClose:f,onRequestClose:f,onCancel:f,onConfirm:F,type:"danger",children:e.jsxs("p",{children:["Are you sure you want cancel this order? This action can't be undo."," "]})})]})};export{ze as default};
