import{Y as M,r as c,j as e,c as U,u as K,W as Y,R as W,T as R}from"./index-BiL_6wO1.js";import{B as v}from"./Button-BDZQFRVN.js";import{t as T,N as B}from"./toast-BTFS_ymD.js";import{C as H}from"./ConfirmDialog-1aUNlPH0.js";import{u as Q,F as $}from"./index.esm-DPWQZQZL.js";import{B as J}from"./BottomStickyBar-DKhIVgb9.js";import{C as X}from"./Card-DhvR2on-.js";import{B as S,D as Z}from"./Dialog-DwdWHXbu.js";import{I as ee}from"./Input-Kt4_5zsU.js";import{A as se,N as A,C as E}from"./react-number-format.es-Ma7y7UTr.js";import{A as V}from"./index-CWPX1wR9.js";import{T as G}from"./index-jYUq1LG-.js";import{S as te}from"./ScrollBar-VDxaIlEs.js";import{u as ae,e as ne,f as re,g as ie,h as le}from"./useResponsive-Ub9y9uDy.js";import{S as ce}from"./SkuSection-B03hmsF6.js";import{f as z}from"./index-BsCXtiZk.js";import{t as oe,z as I}from"./index-RrmeSBJF.js";import"./classNames-CzwFyL_p.js";import"./StatusIcon-Dnu0aB1O.js";import"./index-DTyhqsPu.js";import"./CloseButton-DCv1qkuF.js";import"./index-BWRR-Til.js";import"./isNil-CT_EA3jS.js";import"./_getPrototype-DlX6t2G5.js";import"./useMergeRef-Cw6AoeWY.js";import"./floating-ui.dom-DvzLbbXS.js";import"./toString-BKJBPJYD.js";import"./Select-EZh-ym65.js";const de={productList:[],selectedProduct:[]},L=M(i=>({...de,setProductList:a=>i(()=>({productList:a})),setSelectedProduct:a=>i(()=>({selectedProduct:a}))})),{Tr:_,Th:w,Td:D,THead:me,TBody:ue}=G,xe=()=>{const{productList:i,selectedProduct:a,setSelectedProduct:l}=L(),[p,j]=c.useState(""),[h,o]=c.useState(!1),{smaller:g}=ae(),b=s=>{const t=i.find(n=>n.id===s.id);if(t){if(a.some(n=>n.id===t.id))return;if(t.balance<=0)return;a.push({...t,quantity:1}),l(a)}},N=s=>{l(a.map(t=>(t.id===s.id&&s.balance>t.quantity&&(t.quantity=t.quantity+1),t)))},y=s=>{const t=s;t.quantity=t.quantity-1,t.quantity===0?l(a.filter(n=>n.id!==t.id)):l(a.map(n=>(n.id===t.id&&(n=t),n)))},C=(s,t)=>{const n=s;n.quantity=t.target.valueAsNumber,n.quantity===0?l(a.filter(d=>d.id!==n.id)):(n.quantity>s.balance&&(n.quantity=s.balance),l(a.map(d=>(d.id===n.id&&(d=n),d))))},P=(s,t)=>{s?(a.push({...t,quantity:1}),l(a)):l(a.filter(n=>n.id!==t.id))},k=c.useMemo(()=>a.reduce((s,t)=>s+t.amount*t.quantity,0),[a,a.length]),f=c.useMemo(()=>a.reduce((s,t)=>s+t.bv*t.quantity,0),[a,a.length]);return e.jsxs(e.Fragment,{children:[e.jsxs(X,{id:"selectProducts",children:[e.jsx("h4",{className:"mb-6",children:"Select products"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{data:i,optionKey:s=>s.name,value:p,renderOption:s=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["BV: ",s.bv,s.category_id===1?e.jsx(S,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(S,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]}),e.jsxs("div",{children:["Stock:",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]}),suffix:e.jsx(ne,{className:"text-lg"}),placeholder:"Search product",onInputChange:j,onOptionSelected:b}),e.jsx(v,{type:"button",variant:"solid",onClick:()=>o(!0),children:"Browse products"})]}),e.jsxs(G,{compact:g.sm,className:"mt-6",children:[e.jsx(me,{children:e.jsxs(_,{children:[e.jsx(w,{className:"w-[70%]",children:"Product"}),e.jsx(w,{children:"Price"}),e.jsx(w,{children:"Quantity"}),e.jsx(w,{children:"Total"})]})}),e.jsx(ue,{children:a.length>0?a.map(s=>e.jsxs(_,{children:[e.jsx(D,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("div",{className:"heading-text font-bold",children:s.name}),e.jsxs("div",{children:["BV: ",s.bv,s.category_id===1?e.jsx(S,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(S,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]})}),e.jsx(D,{children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(A,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount,decimalScale:2,thousandSeparator:!0})})}),e.jsx(D,{children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{type:"button",icon:e.jsx(re,{}),size:"xs",onClick:()=>y(s)}),e.jsx("div",{className:"w-15 text-center",children:e.jsx(ee,{type:"number",autoComplete:"off",value:s.quantity,className:"text-center",onChange:t=>C(s,t)})}),e.jsx(v,{type:"button",icon:e.jsx(ie,{}),size:"xs",onClick:()=>N(s)})]})}),e.jsx(D,{children:e.jsx("div",{className:"heading-text font-bold",children:e.jsx(A,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:s.amount*s.quantity,decimalScale:2,thousandSeparator:!0})})})]},s.id)):e.jsx(_,{children:e.jsx(D,{className:"text-center",colSpan:4,children:"No product selected!"})})})]}),e.jsxs("div",{className:"mt-8 flex justify-between",children:[e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Total BV: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(A,{fixedDecimalScale:!0,displayType:"text",value:f,decimalScale:2})})]}),e.jsxs("span",{className:"text-base flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold",children:"Grand Total: "}),e.jsx("span",{className:"text-lg font-bold heading-text",children:e.jsx(A,{fixedDecimalScale:!0,prefix:"₹",displayType:"text",value:k,decimalScale:2,thousandSeparator:!0})})]})]})]}),e.jsxs(Z,{isOpen:h,onClose:()=>o(!1),onRequestClose:()=>o(!1),children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h4",{className:"mb-1",children:"All products"}),e.jsx("p",{children:"Add products to this order."})]}),e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"mb-6",children:e.jsx(te,{className:U("overflow-y-auto h-80"),children:i.map(s=>e.jsxs("div",{className:"py-3 pr-5 rounded-lg flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"px-1",children:s.balance>0?e.jsx(E,{checked:a.some(t=>t.id===s.id),onChange:t=>P(t,s)}):e.jsx(E,{disabled:!0,checked:!1})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(V,{size:"lg",shape:"round",src:s.img_url}),e.jsxs("div",{children:[e.jsx("p",{className:"heading-text font-bold",children:s.name}),e.jsxs("p",{children:["BV: ",s.bv,s.category_id===1?e.jsx(S,{className:"ms-2",content:"P",innerClass:"bg-emerald-500"}):e.jsx(S,{className:"ms-2",content:"R",innerClass:"bg-blue-500"})]})]})]})]}),e.jsxs("div",{children:["Stock:"," ",e.jsx("span",{className:"heading-text font-bold",children:s.balance})]})]},s.id))})})}),e.jsx(v,{block:!0,type:"button",variant:"solid",onClick:()=>o(!1),children:"Done"})]})]})};async function he(i){return R.fetchDataWithAxios({url:`/get-product-list/${i}`,method:"get"})}async function fe(){return R.fetchDataWithAxios({url:"/list-sku",method:"get"})}const pe=I.object({sku_id:I.number().min(1,{message:"SKU required"})}),je=i=>{const[a,l]=c.useState(!0),[p,j]=c.useState(null),{onFormSubmit:h,children:o,defaultValues:g,defaultProducts:b}=i,[N,y]=c.useState([{label:"SKU Name",value:"sku_id",icon:e.jsx(z,{})},,]),{setProductList:C,setSelectedProduct:P}=L(),{user:k}=K();c.useEffect(()=>{he(k.id).then(r=>{C(r)}).catch(r=>{var u;j(((u=r==null?void 0:r.response)==null?void 0:u.data)||r.toString())}).finally(()=>{l(!1)}),fe().then(r=>{y((r==null?void 0:r.filter(u=>u.id!==2).map(u=>({label:u.name,value:u.id,icon:e.jsx(z,{})})))||[])}).catch(r=>{var u;j(((u=r==null?void 0:r.response)==null?void 0:u.data)||r.toString())}).finally(()=>{l(!1)})},[]),c.useEffect(()=>{n({sku_id:""})},[i.refresh]);const f=r=>{h==null||h(r)};function s(r){r.key==="Enter"&&r.preventDefault()}const{handleSubmit:t,reset:n,watch:d,formState:{errors:q},control:m,setValue:x,getValues:O}=Q({defaultValues:{sku_id:"",...g||{}},resolver:oe(pe)}),F=d("sku_id","");return p?e.jsx("div",{children:p.message}):e.jsx("div",{className:"flex",children:a?e.jsx(Y,{loading:!0}):e.jsxs($,{className:"flex-1 flex flex-col overflow-hidden",onSubmit:t(f),onKeyDown:s,children:[e.jsx(W,{children:e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(xe,{}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsx(ce,{control:m,errors:q,skuOptions:N,selectedSku:F})})]})})}),e.jsx(J,{children:o})]})})};async function ge(i){return R.fetchDataWithAxios({url:"/create-transfer",method:"post",data:i})}const Ye=()=>{const{user:i}=K(),{setSelectedProduct:a,selectedProduct:l,setProductList:p,productList:j}=L(),[h,o]=c.useState(!1),[g,b]=c.useState(!1),[N,y]=c.useState(!0),C=async s=>{var d,q;b(!0);const t=l.map(({id:m,quantity:x})=>({id:m,quantity:x}));if(!t.length){T.push(e.jsx(B,{type:"danger",children:"Please select at least one product to create an order."}),{placement:"top-center"}),b(!1);return}const n={id:i.id,sku:s,products:t};try{await ge(n)&&(T.push(e.jsx(B,{type:"success",children:"Stock Transferred!"}),{placement:"top-center"}),p(j.map(x=>{const O=l.find(F=>F.id===x.id);return O&&(x.balance=x.balance-O.quantity),x})),a([]),y(x=>!x))}catch(m){T.push(e.jsx(B,{type:"danger",children:((q=(d=m==null?void 0:m.response)==null?void 0:d.data)==null?void 0:q.message)||m.message.toString()||m.toString()}),{placement:"top-center"})}b(!1)},P=()=>{o(!1),a([]),y(s=>!s),T.push(e.jsx(B,{type:"success",children:"Order discarded!"}),{placement:"top-center"})},k=()=>{o(!0)},f=()=>{o(!1)};return i.id!=2?e.jsx("div",{children:"You are not authorized to access this page."}):e.jsxs(e.Fragment,{children:[e.jsx(je,{onFormSubmit:C,refresh:N,children:e.jsx(W,{children:e.jsxs("div",{className:"flex items-center justify-between px-8",children:[e.jsx("span",{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"ltr:mr-3 rtl:ml-3",type:"button",customColorClass:()=>"border-error ring-1 ring-error text-error hover:border-error hover:ring-error hover:text-error bg-transparent",icon:e.jsx(le,{}),onClick:k,children:"Discard"}),e.jsx(v,{variant:"solid",type:"submit",loading:g,children:"Create"})]})]})})}),e.jsx(H,{isOpen:h,type:"danger",title:"Discard changes",onClose:f,onRequestClose:f,onCancel:f,onConfirm:P,children:e.jsxs("p",{children:["Are you sure you want discard this? This action can't be undo."," "]})})]})};export{Ye as default};
